<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>three-hero — particles</title>
  <style>
    html,body{margin:0;height:100%;background:#000;}
    #hero{position:relative;height:100vh;overflow:hidden}
    #webgl{position:absolute;inset:0;width:100%;height:100%;display:block}
    h1{
      position:absolute;left:8%;bottom:12%;z-index:2;margin:0;
      font:700 clamp(28px,6vw,96px)/1 system-ui,'Noto Sans JP',sans-serif;
      color:#e8ecff;letter-spacing:.02em;mix-blend-mode:screen
    }
  </style>
</head>
<body>
  <section id="hero">
    <canvas id="webgl"></canvas>
    <h1>Your Brand</h1>
  </section>

  <!-- three.js（非モジュール） -->
  <script src="https://unpkg.com/three@0.164.0/build/three.min.js"></script>

  <!-- postprocessing（順序厳守） -->
  <script src="https://unpkg.com/three@0.164.0/examples/js/postprocessing/EffectComposer.js"></script>
  <script src="https://unpkg.com/three@0.164.0/examples/js/postprocessing/RenderPass.js"></script>
  <script src="https://unpkg.com/three@0.164.0/examples/js/shaders/CopyShader.js"></script>
  <script src="https://unpkg.com/three@0.164.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
  <script src="https://unpkg.com/three@0.164.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

  <!-- 自前コード（非モジュール） -->
  <script>
  (function(){
    const canvas = document.getElementById('webgl');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
    renderer.setSize(innerWidth, innerHeight);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
    camera.position.set(0,0,6);

    // ライト
    scene.add(new THREE.HemisphereLight(0xffffff, 0x202040, 0.9));
    const dir = new THREE.DirectionalLight(0xffffff, 0.55);
    dir.position.set(3,3,3); scene.add(dir);

    // 粒子 -----------------------------
    const COUNT = 3200;               // 粒子数（負荷に応じて調整）
    const g = new THREE.BufferGeometry();
    const pos = new Float32Array(COUNT*3);
    for(let i=0;i<COUNT;i++){
      pos[i*3+0]=(Math.random()-0.5)*12;
      pos[i*3+1]=(Math.random()-0.5)*8;
      pos[i*3+2]=(Math.random()-0.5)*10;
    }
    g.setAttribute('position', new THREE.BufferAttribute(pos,3));
    const points = new THREE.Points(
      g,
      new THREE.PointsMaterial({ color:0x66ccff, size:0.05, transparent:true, opacity:0.9 })
    );
    scene.add(points);

    // ガラス板 -------------------------
    const plate = new THREE.Mesh(
      new THREE.PlaneGeometry(3.2, 1.8, 32, 32),
      new THREE.MeshPhysicalMaterial({
        color:0xffffff, metalness:0, roughness:0.08,
        transmission:0.72, thickness:0.4, transparent:true
      })
    );
    plate.position.z = -0.5;
    scene.add(plate);

    // Bloom ----------------------------
    const composer = new THREE.EffectComposer(renderer);
    composer.addPass(new THREE.RenderPass(scene, camera));
    const bloom = new THREE.UnrealBloomPass(
      new THREE.Vector2(innerWidth, innerHeight),
      0.5,     // 強さ
      0.85,    // 半径
      0.8      // しきい値
    );
    composer.addPass(bloom);

    // マウス微パララックス --------------
    const mouse={x:0,y:0};
    addEventListener('pointermove', e=>{
      mouse.x=(e.clientX/innerWidth)-0.5;
      mouse.y=(e.clientY/innerHeight)-0.5;
    });

    // ループ ----------------------------
    let t=0; const clock=new THREE.Clock();
    function tick(){
      const dt=clock.getDelta(); t+=dt;

      // 粒子をゆらす
      const p = points.geometry.attributes.position;
      for(let i=0;i<p.count;i++){
        const iz=i*3+2, iy=i*3+1;
        const z=p.array[iz];
        p.array[iy] += Math.sin(t*0.6 + z)*0.0006;
      }
      p.needsUpdate = true;

      points.rotation.y += dt*0.05;

      camera.position.x += (mouse.x*0.8 - camera.position.x)*0.05;
      camera.position.y += (-mouse.y*0.6 - camera.position.y)*0.05;
      camera.lookAt(0,0,0);

      composer.render();
      requestAnimationFrame(tick);
    }
    tick();

    // リサイズ --------------------------
    addEventListener('resize', ()=>{
      const w=innerWidth, h=innerHeight;
      renderer.setSize(w,h);
      composer.setSize(w,h);
      camera.aspect = w/h;
      camera.updateProjectionMatrix();
    });
  })();
  </script>
</body>
</html>
